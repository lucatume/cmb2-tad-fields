define(["../core","./var/nonce","./var/rquery","../ajax"],function(e,c,b){var a=[],d=/(=)\?(?=&|$)|\?\?/;e.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var f=a.pop()||(e.expando+"_"+(c++));this[f]=true;return f}});e.ajaxPrefilter("json jsonp",function(i,f,j){var l,g,h,k=i.jsonp!==false&&(d.test(i.url)?"url":typeof i.data==="string"&&!(i.contentType||"").indexOf("application/x-www-form-urlencoded")&&d.test(i.data)&&"data");if(k||i.dataTypes[0]==="jsonp"){l=i.jsonpCallback=e.isFunction(i.jsonpCallback)?i.jsonpCallback():i.jsonpCallback;if(k){i[k]=i[k].replace(d,"$1"+l)}else{if(i.jsonp!==false){i.url+=(b.test(i.url)?"&":"?")+i.jsonp+"="+l}}i.converters["script json"]=function(){if(!h){e.error(l+" was not called")}return h[0]};i.dataTypes[0]="json";g=window[l];window[l]=function(){h=arguments};j.always(function(){window[l]=g;if(i[l]){i.jsonpCallback=f.jsonpCallback;a.push(l)}if(h&&e.isFunction(g)){g(h[0])}h=g=undefined});return"script"}})});