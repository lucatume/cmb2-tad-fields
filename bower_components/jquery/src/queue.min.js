define(["./core","./data/var/data_priv","./deferred","./callbacks"],function(b,a){b.extend({queue:function(e,d,f){var c;if(e){d=(d||"fx")+"queue";c=a.get(e,d);if(f){if(!c||b.isArray(f)){c=a.access(e,d,b.makeArray(f))}else{c.push(f)}}return c||[]}},dequeue:function(h,g){g=g||"fx";var d=b.queue(h,g),i=d.length,f=d.shift(),c=b._queueHooks(h,g),e=function(){b.dequeue(h,g)};if(f==="inprogress"){f=d.shift();i--}if(f){if(g==="fx"){d.unshift("inprogress")}delete c.stop;f.call(h,e,c)}if(!i&&c){c.empty.fire()}},_queueHooks:function(e,d){var c=d+"queueHooks";return a.get(e,c)||a.access(e,c,{empty:b.Callbacks("once memory").add(function(){a.remove(e,[d+"queue",c])})})}});b.fn.extend({queue:function(c,d){var e=2;if(typeof c!=="string"){d=c;c="fx";e--}if(arguments.length<e){return b.queue(this[0],c)}return d===undefined?this:this.each(function(){var f=b.queue(this,c,d);b._queueHooks(this,c);if(c==="fx"&&f[0]!=="inprogress"){b.dequeue(this,c)}})},dequeue:function(c){return this.each(function(){b.dequeue(this,c)})},clearQueue:function(c){return this.queue(c||"fx",[])},promise:function(e,j){var d,f=1,k=b.Deferred(),h=this,c=this.length,g=function(){if(!(--f)){k.resolveWith(h,[h])}};if(typeof e!=="string"){j=e;e=undefined}e=e||"fx";while(c--){d=a.get(h[c],e+"queueHooks");if(d&&d.empty){f++;d.empty.add(g)}}g();return k.promise(j)}});return b});